# io_ior job template
# IOR MPI filesystem test using posix, 1 MB chunks
# N to N file access pattern
# NOTE: bash syntax is used here

# FIXME: we should calculate the blocksize, -b, parameter such that
# the aggregate filesize is either some multiple of memory per node
# or a filesize set in cluster.def
ALLARGS="-b 128m -C -i 2 -r -R -t 1m -v -w -W -e -d 30"
TESTDIR="TESTDIR_HERE/$JOBID"
mkdir -p $TESTDIR
PSFILE=`/bin/mktemp $TESTDIR/posix.nto1.XXXXXX`
PPFILE=`/bin/mktemp $TESTDIR/posix.nton.XXXXXX`

cbench_echo "Nto1 file: $PSFILE"
cbench_echo "NtoN files: $PPFILE"
cbench_echo "TESTDIR: $TESTDIR"
cbench_echo

# n-to-n file pattern
CMD="JOBLAUNCH_CMD_HERE CBENCHTEST_BIN_HERE/IOR.posix -a POSIX $ALLARGS -F -o $PPFILE"
cbench_run_cmd $CMD

# quiet things down before the next job
sync
sleep 60
