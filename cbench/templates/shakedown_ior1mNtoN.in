# shakedown_ior job template
# IOR MPI filesystem test using posix, 1 MB chunks
# N to N file access pattern
# NOTE: bash syntax is used here

# we are setting the -b parameter small to not stress the data
# moving side of the equation, but the file create, delete, open,
# etc. side of it, i.e. the sanity of the filesystem
ALLARGS="-b 1m -C -i 2 -r -R -t 1m -v -w -W -e -d 30"
TESTDIR="TESTDIR_HERE/$JOBID"
mkdir -p $TESTDIR
PSFILE=`/bin/mktemp $TESTDIR/posix.nto1.XXXXXX`
PPFILE=`/bin/mktemp $TESTDIR/posix.nton.XXXXXX`

echo "Nto1 file: $PSFILE"
echo "NtoN files: $PPFILE"
echo "TESTDIR: $TESTDIR"
echo

# n-to-n file pattern
CMD="JOBLAUNCH_CMD_HERE CBENCHTEST_BIN_HERE/IOR.posix -a POSIX $ALLARGS -F -o $PPFILE"
cbench_run_cmd $CMD

# quiet things down before the next job
sync
sleep 60
